<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self' 'sha256-e9TEFAEVD2JaLoeOD7bpCxvYE1PD82/N2FG9KG8Jj0A=' https://unpkg.com https://esm.sh https://cdn.esm.sh; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; connect-src 'self' https://0.peerjs.com wss://0.peerjs.com wss: https://unpkg.com https://esm.sh https://cdn.esm.sh; img-src blob:;">
  <title>VaporChat — Ephemeral Encrypted P2P Chat</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <script type="importmap">
  {
    "imports": {
      "openpgp": "https://unpkg.com/openpgp@5.11.2/dist/openpgp.min.mjs",
      "peerjs": "https://esm.sh/peerjs@1.5.4"
    }
  }
  </script>
</head>
<body>
  <div id="app">

    <!-- ═══ Landing Screen ═══ -->
    <div id="screen-landing" class="screen active">
      <pre class="ascii-header">
 ██╗   ██╗ █████╗ ██████╗  ██████╗ ██████╗  ██████╗██╗  ██╗ █████╗ ████████╗
 ██║   ██║██╔══██╗██╔══██╗██╔═══██╗██╔══██╗██╔════╝██║  ██║██╔══██╗╚══██╔══╝
 ██║   ██║███████║██████╔╝██║   ██║██████╔╝██║     ███████║███████║   ██║
 ╚██╗ ██╔╝██╔══██║██╔═══╝ ██║   ██║██╔══██╗██║     ██╔══██║██╔══██║   ██║
  ╚████╔╝ ██║  ██║██║     ╚██████╔╝██║  ██║╚██████╗██║  ██║██║  ██║   ██║
   ╚═══╝  ╚═╝  ╚═╝╚═╝      ╚═════╝ ╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝</pre>
      <p class="tagline">ephemeral · encrypted · peer-to-peer</p>
      <ul class="features">
        <li>No servers — messages travel directly between browsers</li>
        <li>End-to-end PGP encryption — unique keys per session</li>
        <li>Shared links — peers can join until entry is closed</li>
        <li>Zero persistence — nothing survives a closed tab</li>
      </ul>
      <button id="btn-create" class="btn-primary">Create Secure Channel</button>
      <div class="join-divider">
        <span class="join-divider-line"></span>
        <span class="join-divider-text">or join an existing channel</span>
        <span class="join-divider-line"></span>
      </div>
      <div class="join-section">
        <input id="join-input" class="join-input" type="text" placeholder="enter room code" autocomplete="off" spellcheck="false">
        <button id="btn-join" class="btn-primary btn-join">Join</button>
      </div>
      <p id="landing-error" class="landing-error"></p>
      <a href="https://github.com/jdelac7/VaporChat" target="_blank" rel="noopener noreferrer" class="github-link">[ source on github ]</a>
    </div>

    <!-- ═══ Waiting Screen ═══ -->
    <div id="screen-waiting" class="screen">
      <div>
        <p class="codename-label">Your Codename</p>
        <p id="self-codename" class="codename-display"></p>
      </div>
      <div class="share-box">
        <p class="share-label">Room Code</p>
        <p id="room-code" class="room-code-display"></p>
        <button id="btn-copy-code" class="btn-copy">[ COPY CODE ]</button>
        <div class="share-link-row">
          <p id="share-link" class="share-link"></p>
          <button id="btn-copy-link" class="btn-copy btn-copy-small">[ COPY LINK ]</button>
        </div>
      </div>
      <p class="waiting-indicator">Waiting for connection<span class="waiting-dots"></span></p>
      <button id="btn-cancel" class="btn-secondary">Cancel</button>
    </div>

    <!-- ═══ Chat Screen ═══ -->
    <div id="screen-chat" class="screen">
      <div class="status-bar">
        <span id="status-self" class="status-codenames"></span>
        <span class="status-separator">↔</span>
        <span id="status-peer-wrap" class="status-peer-wrap">
          <span id="status-peer-summary" class="status-codenames status-peer-summary"></span>
          <div id="status-peer-list" class="status-peer-list hidden"></div>
        </span>
        <span class="status-encryption">
          <span id="status-dot" class="status-dot"></span>
          E2E encrypted
        </span>
        <span id="status-entry" class="status-entry">entry: open</span>
      </div>
      <div id="message-log" class="message-log"></div>
      <div class="input-area">
        <button id="btn-attach" class="btn-attach" title="Attach file" disabled>[+]</button>
        <span class="input-prompt">&gt;</span>
        <input id="chat-input" class="input-field" type="text" placeholder="Type a message..." autocomplete="off" spellcheck="false">
      </div>
    </div>

    <!-- ═══ Destroyed Screen ═══ -->
    <div id="screen-destroyed" class="screen">
      <div class="destroyed-icon">⊘</div>
      <h2 class="destroyed-title">Channel Destroyed</h2>
      <p class="destroyed-message">
        All keys have been purged from memory.<br>
        No messages were stored.<br>
        No trace remains.
      </p>
      <button id="btn-return" class="btn-primary">Return to Landing</button>
    </div>

    <!-- ═══ Error Screen ═══ -->
    <div id="screen-error" class="screen">
      <h2 class="error-title">Channel Unavailable</h2>
      <p id="error-message" class="error-message"></p>
      <button id="btn-error-return" class="btn-primary">Return to Landing</button>
    </div>

  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
